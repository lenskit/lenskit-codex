schema: '2.0'
stages:
  import:
    cmd: lenskit codex amazon import-train -o dataset ../data/Video_Games.train.csv.gz
    deps:
    - path: ../data/Video_Games.train.csv.gz
      hash: md5
      md5: cf52cdcd1bc96c0251cf525fd3373bf5
      size: 15690763
    outs:
    - path: dataset
      hash: md5
      md5: 926407d419701d2ac913176e2d3d936b.dir
      size: 8849535
      nfiles: 5
  import-valid-train:
    cmd: lenskit data convert --amazon ../data/Video_Games.train.csv.gz splits/fixed/valid/train.dataset
    deps:
    - path: ../data/Video_Games.train.csv.gz
      hash: md5
      md5: cf52cdcd1bc96c0251cf525fd3373bf5
      size: 15690763
    outs:
    - path: splits/fixed/valid/train.dataset
      hash: md5
      md5: af92c1f22474e96fc9aa7f1f55f5a4a8.dir
      size: 8988469
      nfiles: 5
  import-valid-test:
    cmd: lenskit data convert --amazon --item-lists ../data/Video_Games.valid.csv.gz
      splits/fixed/valid/test.parquet
    deps:
    - path: ../data/Video_Games.valid.csv.gz
      hash: md5
      md5: 5b29cd361999229e92cc7c3c49d3bc08
      size: 1558363
    outs:
    - path: splits/fixed/valid/test.parquet
      hash: md5
      md5: f6037e80a107947c1b6334afc23b0bb8
      size: 711768
  import-test-test:
    cmd: lenskit data convert --amazon --item-lists ../data/Video_Games.test.csv.gz
      splits/fixed/test/test.parquet
    deps:
    - path: ../data/Video_Games.test.csv.gz
      hash: md5
      md5: cf9c346ffe32cf46fd1f661032f29841
      size: 1672711
    outs:
    - path: splits/fixed/test/test.parquet
      hash: md5
      md5: a7e4eb1512603de785688970e4be6b24
      size: 770628
  import-test-train:
    cmd: lenskit data convert --amazon ../data/Video_Games.train.csv.gz ../data/Video_Games.valid.csv.gz
      splits/fixed/test/train.dataset
    deps:
    - path: ../data/Video_Games.train.csv.gz
      hash: md5
      md5: cf52cdcd1bc96c0251cf525fd3373bf5
      size: 15690763
    - path: ../data/Video_Games.valid.csv.gz
      hash: md5
      md5: 5b29cd361999229e92cc7c3c49d3bc08
      size: 1558363
    outs:
    - path: splits/fixed/test/train.dataset
      hash: md5
      md5: 9b07f5194df50ab18c592f86ab404dc5.dir
      size: 9353271
      nfiles: 5
  run-fixed-default-als-implicit:
    cmd: lenskit codex generate --default --ds-name=VidGames --split=splits/fixed
      -o runs/fixed/als-implicit-default als-implicit
    deps:
    - path: ../../../src/codex/models/als_implicit.py
      hash: md5
      md5: cb29269f8b896866c0ae2aeceadd6d69
      size: 590
    - path: splits/fixed
      hash: md5
      md5: 25230c805acd506b8b11003757ad8446.dir
      size: 20894072
      nfiles: 17
    outs:
    - path: runs/fixed/als-implicit-default
      hash: md5
      md5: 8a770186cc146713889a7c92f1c4db9c.dir
      size: 15273800
      nfiles: 4
  run-fixed-default-flexmf-warp:
    cmd: lenskit codex generate --default --ds-name=VidGames --split=splits/fixed
      -o runs/fixed/flexmf-warp-default flexmf-warp
    deps:
    - path: ../../../src/codex/models/flexmf_warp.py
      hash: md5
      md5: 8b8cb5b55016546658102325f51dedf9
      size: 657
    - path: splits/fixed
      hash: md5
      md5: 25230c805acd506b8b11003757ad8446.dir
      size: 20894072
      nfiles: 17
    outs:
    - path: runs/fixed/flexmf-warp-default
      hash: md5
      md5: 22b318715e30bbf55872763d787a233f.dir
      size: 15659367
      nfiles: 4
  run-fixed-default-als-biased:
    cmd: lenskit codex generate --default --ds-name=VidGames --split=splits/fixed
      -o runs/fixed/als-biased-default als-biased
    deps:
    - path: ../../../src/codex/models/als_biased.py
      hash: md5
      md5: 935c03f45335b812ed7b6aa63bed914e
      size: 547
    - path: splits/fixed
      hash: md5
      md5: 25230c805acd506b8b11003757ad8446.dir
      size: 20894072
      nfiles: 17
    outs:
    - path: runs/fixed/als-biased-default
      hash: md5
      md5: 913af6a2c2c504350baa3aa7d9903dca.dir
      size: 16930038
      nfiles: 5
  run-fixed-default-bias:
    cmd: lenskit codex generate --default --ds-name=VidGames --split=splits/fixed
      -o runs/fixed/bias-default bias
    deps:
    - path: ../../../src/codex/models/bias.py
      hash: md5
      md5: 8331a4d32969fb83a78c4e43114b9d2a
      size: 458
    - path: splits/fixed
      hash: md5
      md5: 25230c805acd506b8b11003757ad8446.dir
      size: 20894072
      nfiles: 17
    outs:
    - path: runs/fixed/bias-default
      hash: md5
      md5: 49b3dfd67b044ebd62ceebed466a6c9c.dir
      size: 6562775
      nfiles: 5
  run-fixed-default-flexmf-explicit:
    cmd: lenskit codex generate --default --ds-name=VidGames --split=splits/fixed
      -o runs/fixed/flexmf-explicit-default flexmf-explicit
    deps:
    - path: ../../../src/codex/models/flexmf_explicit.py
      hash: md5
      md5: 9271360109ed53980623529abafbc7a4
      size: 527
    - path: splits/fixed
      hash: md5
      md5: 25230c805acd506b8b11003757ad8446.dir
      size: 20894072
      nfiles: 17
    outs:
    - path: runs/fixed/flexmf-explicit-default
      hash: md5
      md5: 50bb168e319233f2803aab83870fc1b5.dir
      size: 17722785
      nfiles: 5
  run-fixed-default-popular:
    cmd: lenskit codex generate --default --ds-name=VidGames --split=splits/fixed
      -o runs/fixed/popular-default popular
    deps:
    - path: ../../../src/codex/models/popular.py
      hash: md5
      md5: c1b8d18adf4c2f7d9807ad4f8c766732
      size: 56
    - path: splits/fixed
      hash: md5
      md5: 25230c805acd506b8b11003757ad8446.dir
      size: 20894072
      nfiles: 17
    outs:
    - path: runs/fixed/popular-default
      hash: md5
      md5: a583ef2750849fd6bd2b0917984e1f50.dir
      size: 1297464
      nfiles: 4
  run-fixed-default-flexmf-bpr:
    cmd: lenskit codex generate --default --ds-name=VidGames --split=splits/fixed
      -o runs/fixed/flexmf-bpr-default flexmf-bpr
    deps:
    - path: ../../../src/codex/models/flexmf_bpr.py
      hash: md5
      md5: 94acb427f7b39b627be488ba2558067c
      size: 663
    - path: splits/fixed
      hash: md5
      md5: 25230c805acd506b8b11003757ad8446.dir
      size: 20894072
      nfiles: 17
    outs:
    - path: runs/fixed/flexmf-bpr-default
      hash: md5
      md5: b242cf5596e1c4b10b308428c91e8f3a.dir
      size: 15672767
      nfiles: 4
  run-fixed-default-flexmf-logistic:
    cmd: lenskit codex generate --default --ds-name=VidGames --split=splits/fixed
      -o runs/fixed/flexmf-logistic-default flexmf-logistic
    deps:
    - path: ../../../src/codex/models/flexmf_logistic.py
      hash: md5
      md5: bbad471f8ca28fa9c5a9818432bc7ac8
      size: 748
    - path: splits/fixed
      hash: md5
      md5: 25230c805acd506b8b11003757ad8446.dir
      size: 20894072
      nfiles: 17
    outs:
    - path: runs/fixed/flexmf-logistic-default
      hash: md5
      md5: c1f5282cf635cc0d99d2c37397567887.dir
      size: 15851100
      nfiles: 4
  export-trec-qrels@test:
    cmd: lenskit codex trec export qrels -o splits/fixed/test.qrels.gz splits/fixed/test/test.parquet
    deps:
    - path: splits/fixed/test/test.parquet
      hash: md5
      md5: a7e4eb1512603de785688970e4be6b24
      size: 770628
    outs:
    - path: splits/fixed/test.qrels.gz
      hash: md5
      md5: 70dcac56d859faadc5fe4c8c84177eea
      size: 552473
  export-trec-qrels@valid:
    cmd: lenskit codex trec export qrels -o splits/fixed/valid.qrels.gz splits/fixed/valid/test.parquet
    deps:
    - path: splits/fixed/valid/test.parquet
      hash: md5
      md5: f6037e80a107947c1b6334afc23b0bb8
      size: 711768
    outs:
    - path: splits/fixed/valid.qrels.gz
      hash: md5
      md5: 786240b7caa98600bb1b0b34433b5b07
      size: 517325
  export-trec-default-runs:
    cmd: lenskit codex trec export runs -o runs/fixed/default.run.gz runs/fixed/*-default
    deps:
    - path: runs/fixed/als-biased-default/recommendations.parquet
      hash: md5
      md5: f4452d53e28866ad37055ffeac926a23
      size: 14127574
    - path: runs/fixed/als-implicit-default/recommendations.parquet
      hash: md5
      md5: a6079e67d05413ef0a69b9473a054423
      size: 14674766
    - path: runs/fixed/bias-default/recommendations.parquet
      hash: md5
      md5: ccc2929c250b02136ffaa6f4710cb53f
      size: 3768085
    - path: runs/fixed/flexmf-bpr-default/recommendations.parquet
      hash: md5
      md5: 07f26342a97745bd1f27ce2d6ba7eee8
      size: 15132659
    - path: runs/fixed/flexmf-explicit-default/recommendations.parquet
      hash: md5
      md5: e10ebbe5ffb0b55557de07dc3a06f7cd
      size: 14932354
    - path: runs/fixed/flexmf-logistic-default/recommendations.parquet
      hash: md5
      md5: 923b38395c9b36fa5d2df725377443ff
      size: 15313954
    - path: runs/fixed/flexmf-warp-default/recommendations.parquet
      hash: md5
      md5: 33376165bb5973a2bb8e0f86cd763cac
      size: 15121014
    - path: runs/fixed/popular-default/recommendations.parquet
      hash: md5
      md5: 50ebd323c58e230e61d5f612d5f94ac9
      size: 725217
    outs:
    - path: runs/fixed/default.run.gz
      hash: md5
      md5: 294c314ec52ab235e84f23804561e4f9
      size: 228617829
  sweep-als-biased-fixed-optuna:
    cmd: lenskit codex search --split=splits/fixed --test-part=valid --optuna --metric=RMSE
      als-biased sweeps/fixed/als-biased-optuna
    deps:
    - path: ../../../src/codex/models/als_biased.py
      hash: md5
      md5: 935c03f45335b812ed7b6aa63bed914e
      size: 547
    - path: splits/fixed
      hash: md5
      md5: 25230c805acd506b8b11003757ad8446.dir
      size: 20894072
      nfiles: 17
    params:
      ../../../config.toml:
        tuning.optuna.points: 40
    outs:
    - path: sweeps/fixed/als-biased-optuna
      hash: md5
      md5: 26fdf7705a693b7e85ce6f115de01f6b.dir
      size: 446403
      nfiles: 5
    - path: sweeps/fixed/als-biased-optuna.json
      hash: md5
      md5: b943e86a47231a54862d1c1f04a04bc7
      size: 673
  run-fixed-optuna-best-als-biased:
    cmd: lenskit codex generate --param-file sweeps/fixed/als-biased-optuna.json --ds-name=VidGames
      --split=splits/fixed -o runs/fixed/als-biased-optuna-best als-biased
    deps:
    - path: ../../../src/codex/models/als_biased.py
      hash: md5
      md5: 935c03f45335b812ed7b6aa63bed914e
      size: 547
    - path: splits/fixed
      hash: md5
      md5: 25230c805acd506b8b11003757ad8446.dir
      size: 20894072
      nfiles: 17
    - path: sweeps/fixed/als-biased-optuna.json
      hash: md5
      md5: b943e86a47231a54862d1c1f04a04bc7
      size: 673
    outs:
    - path: runs/fixed/als-biased-optuna-best
      hash: md5
      md5: 716b6a572e259999d85ca0c901308041.dir
      size: 13026224
      nfiles: 5
  sweep-flexmf-warp-fixed-optuna:
    cmd: lenskit codex search --split=splits/fixed --test-part=valid --optuna --metric=RBP
      flexmf-warp sweeps/fixed/flexmf-warp-optuna
    deps:
    - path: ../../../src/codex/models/flexmf_warp.py
      hash: md5
      md5: 8b8cb5b55016546658102325f51dedf9
      size: 657
    - path: splits/fixed
      hash: md5
      md5: 25230c805acd506b8b11003757ad8446.dir
      size: 20894072
      nfiles: 17
    params:
      ../../../config.toml:
        tuning.optuna.points: 40
    outs:
    - path: sweeps/fixed/flexmf-warp-optuna
      hash: md5
      md5: fbe101fbe1965edbc811499570fec481.dir
      size: 543662
      nfiles: 5
    - path: sweeps/fixed/flexmf-warp-optuna.json
      hash: md5
      md5: 5c09b71ba7846f399ef05b5da16b9b87
      size: 624
