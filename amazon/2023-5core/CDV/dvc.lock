schema: '2.0'
stages:
  import:
    cmd: lenskit data convert --amazon ../data/CDs_and_Vinyl.train.csv.gz dataset
    deps:
    - path: ../data/CDs_and_Vinyl.train.csv.gz
      hash: md5
      md5: 52f026f7362db207ff7bcc8696025da0
      size: 32949116
    outs:
    - path: dataset
      hash: md5
      md5: 15b10977d7889919647237f7aeca4ee3.dir
      size: 17455240
      nfiles: 5
  import-valid-train:
    cmd: lenskit data convert --amazon ../data/CDs_and_Vinyl.train.csv.gz splits/fixed/valid/train.dataset
    deps:
    - path: ../data/CDs_and_Vinyl.train.csv.gz
      hash: md5
      md5: 52f026f7362db207ff7bcc8696025da0
      size: 32949116
    outs:
    - path: splits/fixed/valid/train.dataset
      hash: md5
      md5: 54b3836f55b2fceaf80b654131ecdeca.dir
      size: 17455283
      nfiles: 5
  import-full-train:
    cmd: lenskit data convert --amazon ../data/CDs_and_Vinyl.train.csv.gz ../data/CDs_and_Vinyl.valid.csv.gz
      dataset
    deps:
    - path: ../data/CDs_and_Vinyl.train.csv.gz
      hash: md5
      md5: 52f026f7362db207ff7bcc8696025da0
      size: 32949116
    - path: ../data/CDs_and_Vinyl.valid.csv.gz
      hash: md5
      md5: 6b746db4246195b2fb1b8fd239c1204b
      size: 1782019
    outs:
    - path: dataset
      hash: md5
      md5: dc321505f06a051d99ef184607c66d69.dir
      size: 17730609
      nfiles: 5
  import-valid-test:
    cmd: lenskit data convert --amazon --item-lists ../data/CDs_and_Vinyl.valid.csv.gz
      splits/fixed/valid/test.parquet
    deps:
    - path: ../data/CDs_and_Vinyl.valid.csv.gz
      hash: md5
      md5: 6b746db4246195b2fb1b8fd239c1204b
      size: 1782019
    outs:
    - path: splits/fixed/valid/test.parquet
      hash: md5
      md5: faadcf5855ea6ceb27f48fe3b8bf37ed
      size: 630185
  import-test-test:
    cmd: lenskit data convert --amazon --item-lists ../data/CDs_and_Vinyl.test.csv.gz
      splits/fixed/test/test.parquet
    deps:
    - path: ../data/CDs_and_Vinyl.test.csv.gz
      hash: md5
      md5: 66d76238e903c0e6807e881790705712
      size: 1273480
    outs:
    - path: splits/fixed/test/test.parquet
      hash: md5
      md5: 5e5124caf70c8f49f071f615ed6263de
      size: 421326
  import-test-train:
    cmd: lenskit data convert --amazon ../data/CDs_and_Vinyl.train.csv.gz ../data/CDs_and_Vinyl.valid.csv.gz
      splits/fixed/test/train.dataset
    deps:
    - path: ../data/CDs_and_Vinyl.train.csv.gz
      hash: md5
      md5: 52f026f7362db207ff7bcc8696025da0
      size: 32949116
    - path: ../data/CDs_and_Vinyl.valid.csv.gz
      hash: md5
      md5: 6b746db4246195b2fb1b8fd239c1204b
      size: 1782019
    outs:
    - path: splits/fixed/test/train.dataset
      hash: md5
      md5: 4cae0c3883bdcb271357e0d29b55838f.dir
      size: 17730652
      nfiles: 5
  run-fixed-default-flexmf-warp:
    cmd: lenskit codex generate --default --ds-name=CDV --split=splits/fixed -o runs/fixed/flexmf-warp-default
      flexmf-warp
    deps:
    - path: ../../../src/codex/models/flexmf_warp.py
      hash: md5
      md5: 8b8cb5b55016546658102325f51dedf9
      size: 657
    - path: splits/fixed
      hash: md5
      md5: d4e22abc5855ed28172f8b693a4d08b1.dir
      size: 37614864
      nfiles: 19
    outs:
    - path: runs/fixed/flexmf-warp-default
      hash: md5
      md5: d2e88b17ae2ffbedb39f2e5e38b7459b.dir
      size: 14522591
      nfiles: 4
  run-fixed-default-flexmf-explicit:
    cmd: lenskit codex generate --default --ds-name=CDV --split=splits/fixed -o runs/fixed/flexmf-explicit-default
      flexmf-explicit
    deps:
    - path: ../../../src/codex/models/flexmf_explicit.py
      hash: md5
      md5: 9271360109ed53980623529abafbc7a4
      size: 527
    - path: splits/fixed
      hash: md5
      md5: d4e22abc5855ed28172f8b693a4d08b1.dir
      size: 37614864
      nfiles: 19
    outs:
    - path: runs/fixed/flexmf-explicit-default
      hash: md5
      md5: 71d8126878936fcfd2a1a179229ea1bb.dir
      size: 12308006
      nfiles: 5
  run-fixed-default-als-implicit:
    cmd: lenskit codex generate --default --ds-name=CDV --split=splits/fixed -o runs/fixed/als-implicit-default
      als-implicit
    deps:
    - path: ../../../src/codex/models/als_implicit.py
      hash: md5
      md5: cb29269f8b896866c0ae2aeceadd6d69
      size: 590
    - path: splits/fixed
      hash: md5
      md5: d4e22abc5855ed28172f8b693a4d08b1.dir
      size: 37614864
      nfiles: 19
    outs:
    - path: runs/fixed/als-implicit-default
      hash: md5
      md5: fd0399dd279b39128513af57f8e57632.dir
      size: 10853908
      nfiles: 4
  run-fixed-default-flexmf-bpr:
    cmd: lenskit codex generate --default --ds-name=CDV --split=splits/fixed -o runs/fixed/flexmf-bpr-default
      flexmf-bpr
    deps:
    - path: ../../../src/codex/models/flexmf_bpr.py
      hash: md5
      md5: 94acb427f7b39b627be488ba2558067c
      size: 663
    - path: splits/fixed
      hash: md5
      md5: d4e22abc5855ed28172f8b693a4d08b1.dir
      size: 37614864
      nfiles: 19
    outs:
    - path: runs/fixed/flexmf-bpr-default
      hash: md5
      md5: abba9fe502b4f7556fc5872f8b04bdcc.dir
      size: 14547102
      nfiles: 4
  run-fixed-default-popular:
    cmd: lenskit codex generate --default --ds-name=CDV --split=splits/fixed -o runs/fixed/popular-default
      popular
    deps:
    - path: ../../../src/codex/models/popular.py
      hash: md5
      md5: c1b8d18adf4c2f7d9807ad4f8c766732
      size: 56
    - path: splits/fixed
      hash: md5
      md5: d4e22abc5855ed28172f8b693a4d08b1.dir
      size: 37614864
      nfiles: 19
    outs:
    - path: runs/fixed/popular-default
      hash: md5
      md5: 8dd41183bae8506b7d8117089d9d5410.dir
      size: 724941
      nfiles: 4
  run-fixed-default-als-biased:
    cmd: lenskit codex generate --default --ds-name=CDV --split=splits/fixed -o runs/fixed/als-biased-default
      als-biased
    deps:
    - path: ../../../src/codex/models/als_biased.py
      hash: md5
      md5: 935c03f45335b812ed7b6aa63bed914e
      size: 547
    - path: splits/fixed
      hash: md5
      md5: d4e22abc5855ed28172f8b693a4d08b1.dir
      size: 37614864
      nfiles: 19
    outs:
    - path: runs/fixed/als-biased-default
      hash: md5
      md5: 93fc2c81a90319c4aadf7b3b6e153a1c.dir
      size: 12026223
      nfiles: 5
  run-fixed-default-flexmf-logistic:
    cmd: lenskit codex generate --default --ds-name=CDV --split=splits/fixed -o runs/fixed/flexmf-logistic-default
      flexmf-logistic
    deps:
    - path: ../../../src/codex/models/flexmf_logistic.py
      hash: md5
      md5: bbad471f8ca28fa9c5a9818432bc7ac8
      size: 748
    - path: splits/fixed
      hash: md5
      md5: d4e22abc5855ed28172f8b693a4d08b1.dir
      size: 37614864
      nfiles: 19
    outs:
    - path: runs/fixed/flexmf-logistic-default
      hash: md5
      md5: ba006045a355b4a2fe385c44c3576815.dir
      size: 13214803
      nfiles: 4
  run-fixed-default-bias:
    cmd: lenskit codex generate --default --ds-name=CDV --split=splits/fixed -o runs/fixed/bias-default
      bias
    deps:
    - path: ../../../src/codex/models/bias.py
      hash: md5
      md5: 8331a4d32969fb83a78c4e43114b9d2a
      size: 458
    - path: splits/fixed
      hash: md5
      md5: d4e22abc5855ed28172f8b693a4d08b1.dir
      size: 37614864
      nfiles: 19
    outs:
    - path: runs/fixed/bias-default
      hash: md5
      md5: e14a7b55cd729ce61a5ad69e6b0cdc0e.dir
      size: 5212582
      nfiles: 5
  export-valid-qrels:
    cmd: lenskit codex trec export qrels -o splits/fixed/valid.qrels.zst splits/fixed/valid/test.parquet
    deps:
    - path: splits/fixed/valid/test.parquet
      hash: md5
      md5: faadcf5855ea6ceb27f48fe3b8bf37ed
      size: 630185
    outs:
    - path: splits/fixed/valid.qrels.zst
      hash: md5
      md5: 54bce71d1b63d40b09ddf8e7fa64e797
      size: 413041
  export-test-qrels:
    cmd: lenskit codex trec export qrels -o splits/fixed/test.qrels.zst splits/fixed/test/test.parquet
    deps:
    - path: splits/fixed/test/test.parquet
      hash: md5
      md5: 5e5124caf70c8f49f071f615ed6263de
      size: 421326
    outs:
    - path: splits/fixed/test.qrels.zst
      hash: md5
      md5: 5615dc4a937daf6ad126694a2c3ca755
      size: 275599
  export-trec-qrels@test:
    cmd: lenskit codex trec export qrels -o splits/fixed/test.qrels.gz splits/fixed/test/test.parquet
    deps:
    - path: splits/fixed/test/test.parquet
      hash: md5
      md5: 5e5124caf70c8f49f071f615ed6263de
      size: 421326
    outs:
    - path: splits/fixed/test.qrels.gz
      hash: md5
      md5: 5615dc4a937daf6ad126694a2c3ca755
      size: 275599
  export-trec-qrels@valid:
    cmd: lenskit codex trec export qrels -o splits/fixed/valid.qrels.gz splits/fixed/valid/test.parquet
    deps:
    - path: splits/fixed/valid/test.parquet
      hash: md5
      md5: faadcf5855ea6ceb27f48fe3b8bf37ed
      size: 630185
    outs:
    - path: splits/fixed/valid.qrels.gz
      hash: md5
      md5: 54bce71d1b63d40b09ddf8e7fa64e797
      size: 413041
  export-trec-default-runs:
    cmd: lenskit codex trec export runs -o runs/fixed/default.run.gz runs/fixed/*-default
    deps:
    - path: runs/fixed/als-biased-default/recommendations.parquet
      hash: md5
      md5: 5e62e76f4787135d34b28fbbe678842b
      size: 10086323
    - path: runs/fixed/als-implicit-default/recommendations.parquet
      hash: md5
      md5: ffa3b9de47a5198b9681ea705d9eda9c
      size: 10486175
    - path: runs/fixed/bias-default/recommendations.parquet
      hash: md5
      md5: c30b7993eafc1d764a70155fa20591bd
      size: 3284834
    - path: runs/fixed/flexmf-bpr-default/recommendations.parquet
      hash: md5
      md5: ac3b85a46328e78cfb98f160ce83971b
      size: 14218575
    - path: runs/fixed/flexmf-explicit-default/recommendations.parquet
      hash: md5
      md5: 74210eb7169cac7660b5bcfe7d032884
      size: 10377060
    - path: runs/fixed/flexmf-logistic-default/recommendations.parquet
      hash: md5
      md5: 8618ee83e7daced2172bdc45515649e6
      size: 12887946
    - path: runs/fixed/flexmf-warp-default/recommendations.parquet
      hash: md5
      md5: 056a70319a9eadc21ec44399dafb4eca
      size: 14193673
    - path: runs/fixed/popular-default/recommendations.parquet
      hash: md5
      md5: aa0d4e305cf0c41a28a4b7608dfbb912
      size: 382314
    outs:
    - path: runs/fixed/default.run.gz
      hash: md5
      md5: 755d082b9f8de0c832b44048ae552d47
      size: 145639002
  sweep-bias-fixed-optuna:
    cmd: lenskit codex search --split=splits/fixed --test-part=valid --optuna --metric=RMSE
      bias sweeps/fixed/bias-optuna
    deps:
    - path: ../../../src/codex/models/bias.py
      hash: md5
      md5: 8331a4d32969fb83a78c4e43114b9d2a
      size: 458
    - path: splits/fixed
      hash: md5
      md5: d4e22abc5855ed28172f8b693a4d08b1.dir
      size: 37614864
      nfiles: 19
    params:
      ../../../config.toml:
        tuning.optuna.points: 40
    outs:
    - path: sweeps/fixed/bias-optuna
      hash: md5
      md5: 5766f5608a97a96f449a545241083b04.dir
      size: 302394
      nfiles: 4
    - path: sweeps/fixed/bias-optuna.json
      hash: md5
      md5: befe32397c3107c1a23daba5c0c779b1
      size: 624
  run-fixed-optuna-best-bias:
    cmd: lenskit codex generate --param-file sweeps/fixed/bias-optuna.json --ds-name=CDV
      --split=splits/fixed -o runs/fixed/bias-optuna-best bias
    deps:
    - path: ../../../src/codex/models/bias.py
      hash: md5
      md5: 8331a4d32969fb83a78c4e43114b9d2a
      size: 458
    - path: splits/fixed
      hash: md5
      md5: d4e22abc5855ed28172f8b693a4d08b1.dir
      size: 37614864
      nfiles: 19
    - path: sweeps/fixed/bias-optuna.json
      hash: md5
      md5: befe32397c3107c1a23daba5c0c779b1
      size: 624
    outs:
    - path: runs/fixed/bias-optuna-best
      hash: md5
      md5: 8a397faca278d406c839fadd1e659b7b.dir
      size: 8846343
      nfiles: 5
  sweep-flexmf-explicit-fixed-optuna:
    cmd: lenskit codex search --split=splits/fixed --test-part=valid --optuna --metric=RMSE
      flexmf-explicit sweeps/fixed/flexmf-explicit-optuna
    deps:
    - path: ../../../src/codex/models/flexmf_explicit.py
      hash: md5
      md5: 9271360109ed53980623529abafbc7a4
      size: 527
    - path: splits/fixed
      hash: md5
      md5: d4e22abc5855ed28172f8b693a4d08b1.dir
      size: 37614864
      nfiles: 19
    params:
      ../../../config.toml:
        tuning.optuna.points: 40
    outs:
    - path: sweeps/fixed/flexmf-explicit-optuna
      hash: md5
      md5: ee1812a6c5e3e95315660db07da4fd94.dir
      size: 504798
      nfiles: 5
    - path: sweeps/fixed/flexmf-explicit-optuna.json
      hash: md5
      md5: ceb5cdf4a5f12ee9d77ff83a197cf91b
      size: 636
  sweep-als-biased-fixed-optuna:
    cmd: lenskit codex search --split=splits/fixed --test-part=valid --optuna --metric=RMSE
      als-biased sweeps/fixed/als-biased-optuna
    deps:
    - path: ../../../src/codex/models/als_biased.py
      hash: md5
      md5: 935c03f45335b812ed7b6aa63bed914e
      size: 547
    - path: splits/fixed
      hash: md5
      md5: d4e22abc5855ed28172f8b693a4d08b1.dir
      size: 37614864
      nfiles: 19
    params:
      ../../../config.toml:
        tuning.optuna.points: 40
    outs:
    - path: sweeps/fixed/als-biased-optuna
      hash: md5
      md5: 0d13c365ab9071f269c0f788d6538576.dir
      size: 474092
      nfiles: 5
    - path: sweeps/fixed/als-biased-optuna.json
      hash: md5
      md5: 651a5ae7a9867ce3f982defaec5f31e2
      size: 676
  run-fixed-optuna-best-als-biased:
    cmd: lenskit codex generate --param-file sweeps/fixed/als-biased-optuna.json --ds-name=CDV
      --split=splits/fixed -o runs/fixed/als-biased-optuna-best als-biased
    deps:
    - path: ../../../src/codex/models/als_biased.py
      hash: md5
      md5: 935c03f45335b812ed7b6aa63bed914e
      size: 547
    - path: splits/fixed
      hash: md5
      md5: d4e22abc5855ed28172f8b693a4d08b1.dir
      size: 37614864
      nfiles: 19
    - path: sweeps/fixed/als-biased-optuna.json
      hash: md5
      md5: 651a5ae7a9867ce3f982defaec5f31e2
      size: 676
    outs:
    - path: runs/fixed/als-biased-optuna-best
      hash: md5
      md5: e28c2244c0ba6193a93c5a07f624b34f.dir
      size: 10061678
      nfiles: 5
  sweep-flexmf-logistic-fixed-optuna:
    cmd: lenskit codex search --split=splits/fixed --test-part=valid --optuna --metric=RBP
      flexmf-logistic sweeps/fixed/flexmf-logistic-optuna
    deps:
    - path: ../../../src/codex/models/flexmf_logistic.py
      hash: md5
      md5: bbad471f8ca28fa9c5a9818432bc7ac8
      size: 748
    - path: splits/fixed
      hash: md5
      md5: d4e22abc5855ed28172f8b693a4d08b1.dir
      size: 37614864
      nfiles: 19
    params:
      ../../../config.toml:
        tuning.optuna.points: 40
    outs:
    - path: sweeps/fixed/flexmf-logistic-optuna
      hash: md5
      md5: 429e71e096410362a09ac82dfd5fca17.dir
      size: 682145
      nfiles: 5
    - path: sweeps/fixed/flexmf-logistic-optuna.json
      hash: md5
      md5: 7c9de4c2f53b6e6b6904d5e8551ca57d
      size: 701
