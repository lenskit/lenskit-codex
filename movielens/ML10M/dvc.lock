schema: '2.0'
stages:
  import-data:
    cmd: python ../import-ml.py ml-10m.zip
    deps:
    - path: ../import-ml.py
      hash: md5
      md5: 4af94250c13bdd7beff8235e442549c6
      size: 3732
    - path: ml-10m.zip
      hash: md5
      md5: ce571fd55effeba0271552578f2648bd
      size: 65566137
    outs:
    - path: ratings.duckdb
      hash: md5
      md5: bb2d6543a308997e7c27c971dc13aafe
      size: 95432704
  import-ml-10m:
    cmd: python ../import-ml.py ml-10m.zip
    deps:
    - path: ../import-ml.py
      hash: md5
      md5: af82da24d16bfef7681fe0b7910d5069
      size: 3678
    - path: ../ml-stats.sql
      hash: md5
      md5: b016dc983a2156e0712a846097a968e7
      size: 1307
    - path: ml-10m.zip
      hash: md5
      md5: ce571fd55effeba0271552578f2648bd
      size: 65566137
    outs:
    - path: ratings.duckdb
      hash: md5
      md5: 1a8b11ed426f9ff718074d7ce44e3dcd
      size: 120598528
  ml-10m-stats:
    cmd: python ../../scripts/duckdb-sql.py -d stats.duckdb ../ml-stats.sql
    deps:
    - path: ../ml-stats.sql
      hash: md5
      md5: bf09f212fabc98275ae949932889654c
      size: 1374
    - path: ratings.parquet
      hash: md5
      md5: 0854162a108211f4af074b65a8e8ddaa
      size: 78007629
    outs:
    - path: stats.duckdb
      hash: md5
      md5: 59d6961bed0bbe6c0822c4999a29cb09
      size: 2895872
  split-random:
    cmd: python ../../../action.py split random.toml
    deps:
    - path: ../ratings.duckdb
      hash: md5
      md5: 1a8b11ed426f9ff718074d7ce44e3dcd
      size: 120598528
    - path: random.toml
      hash: md5
      md5: 276ffa520abcf2243c9ffee115774a98
      size: 137
    params:
      ../../../config.toml:
        random.seed: 20240717
    outs:
    - path: random.duckdb
      hash: md5
      md5: 2fe28eddcd080083e5bc510e507ed33d
      size: 1323008
  sweep-random-Bias:
    cmd: python ../../scripts/sweep.py -p 1 Bias splits/random.duckdb ratings.duckdb
      sweeps/random/Bias.duckdb
    deps:
    - path: ../../codex/models/Bias.py
      hash: md5
      md5: e35eac761bf892674a6fb8570132e7f1
      size: 375
    - path: ratings.duckdb
      hash: md5
      md5: 1a8b11ed426f9ff718074d7ce44e3dcd
      size: 120598528
    - path: splits/random.duckdb
      hash: md5
      md5: 2fe28eddcd080083e5bc510e507ed33d
      size: 1323008
    params:
      ../../config.toml:
        random.seed: 20240717
    outs:
    - path: sweeps/random/Bias.duckdb
      hash: md5
      md5: 7e554032ce3a8244daa34a283909405a
      size: 159920128
  sweep-random-BiasedMF-ALS:
    cmd: python ../../scripts/sweep.py -p 1 BiasedMF-ALS splits/random.duckdb ratings.duckdb
      sweeps/random/BiasedMF-ALS.duckdb
    deps:
    - path: ../../codex/models/BiasedMF_ALS.py
      hash: md5
      md5: 70b01ec78dc3f1c3d09190c032bc05a6
      size: 349
    - path: ratings.duckdb
      hash: md5
      md5: 1a8b11ed426f9ff718074d7ce44e3dcd
      size: 120598528
    - path: splits/random.duckdb
      hash: md5
      md5: 2fe28eddcd080083e5bc510e507ed33d
      size: 1323008
    params:
      ../../config.toml:
        random.seed: 20240717
    outs:
    - path: sweeps/random/BiasedMF-ALS.duckdb
      hash: md5
      md5: 9c03abcf3d36777ed11c497bd54c2af6
      size: 303050752
  sweep-random-ImplicitMF-ALS:
    cmd: python ../../scripts/sweep.py -p 1 ImplicitMF-ALS splits/random.duckdb ratings.duckdb
      sweeps/random/ImplicitMF-ALS.duckdb
    deps:
    - path: ../../codex/models/ImplicitMF_ALS.py
      hash: md5
      md5: f88cb5bd1014e55b8c0d9a1650863c94
      size: 359
    - path: ratings.duckdb
      hash: md5
      md5: 1a8b11ed426f9ff718074d7ce44e3dcd
      size: 120598528
    - path: splits/random.duckdb
      hash: md5
      md5: 2fe28eddcd080083e5bc510e507ed33d
      size: 1323008
    params:
      ../../config.toml:
        random.seed: 20240717
    outs:
    - path: sweeps/random/ImplicitMF-ALS.duckdb
      hash: md5
      md5: badd872611dff9b248332935049a7e8e
      size: 281030656
  sweep-random-IKNN-Explicit:
    cmd: python ../../scripts/sweep.py -p 1 IKNN-Explicit splits/random.duckdb ratings.duckdb
      sweeps/random/IKNN-Explicit.duckdb
    deps:
    - path: ../../codex/models/IKNN_Explicit.py
      hash: md5
      md5: d7b6a1734bea39997f94df4fa0c4900e
      size: 378
    - path: ratings.duckdb
      hash: md5
      md5: 1a8b11ed426f9ff718074d7ce44e3dcd
      size: 120598528
    - path: splits/random.duckdb
      hash: md5
      md5: 2fe28eddcd080083e5bc510e507ed33d
      size: 1323008
    params:
      ../../config.toml:
        random.seed: 20240717
    outs:
    - path: sweeps/random/IKNN-Explicit.duckdb
      hash: md5
      md5: 616f39ffaa5dd90123a2aa94697ee17d
      size: 120598528
  sweep-random-IKNN-Implicit:
    cmd: python ../../scripts/sweep.py -p 1 IKNN-Implicit splits/random.duckdb ratings.duckdb
      sweeps/random/IKNN-Implicit.duckdb
    deps:
    - path: ../../codex/models/IKNN_Implicit.py
      hash: md5
      md5: 3ca2f37d6c1983760fcd2ff03a0a57cb
      size: 363
    - path: ratings.duckdb
      hash: md5
      md5: 1a8b11ed426f9ff718074d7ce44e3dcd
      size: 120598528
    - path: splits/random.duckdb
      hash: md5
      md5: 2fe28eddcd080083e5bc510e507ed33d
      size: 1323008
    params:
      ../../config.toml:
        random.seed: 20240717
    outs:
    - path: sweeps/random/IKNN-Implicit.duckdb
      hash: md5
      md5: ccbf0cff15e9b93e5ff088f1b88a6814
      size: 112996352
  import:
    cmd: python ../import-ml.py ml-10m.zip
    deps:
    - path: ../import-ml.py
      hash: md5
      md5: af82da24d16bfef7681fe0b7910d5069
      size: 3678
    - path: ../ml-stats.sql
      hash: md5
      md5: b016dc983a2156e0712a846097a968e7
      size: 1307
    - path: ml-10m.zip
      hash: md5
      md5: ce571fd55effeba0271552578f2648bd
      size: 65566137
    outs:
    - path: ratings.duckdb
      hash: md5
      md5: 1a8b11ed426f9ff718074d7ce44e3dcd
      size: 120598528
  export-random-Bias:
    cmd: python ../../scripts/sweep.py --export sweeps/random/Bias.duckdb rmse
    deps:
    - path: ../../scripts/sweep.py
      hash: md5
      md5: f317b2b216223b72034e4e3b84dfd310
      size: 7543
    - path: sweeps/random/Bias.duckdb
      hash: md5
      md5: 7e554032ce3a8244daa34a283909405a
      size: 159920128
    outs:
    - path: sweeps/random/Bias.csv
      hash: md5
      md5: 55620458d347e161f1056b48bca98902
      size: 2081
    - path: sweeps/random/Bias.json
      hash: md5
      md5: 8dbafb863dceab3d073f5f0a99062a2e
      size: 322
  export-random-BiasedMF-ALS:
    cmd: python ../../scripts/sweep.py --export sweeps/random/BiasedMF-ALS.duckdb
      rmse
    deps:
    - path: ../../scripts/sweep.py
      hash: md5
      md5: f317b2b216223b72034e4e3b84dfd310
      size: 7543
    - path: sweeps/random/BiasedMF-ALS.duckdb
      hash: md5
      md5: 9c03abcf3d36777ed11c497bd54c2af6
      size: 303050752
    outs:
    - path: sweeps/random/BiasedMF-ALS.csv
      hash: md5
      md5: 5dfe1d63f7ccaa97fd7e39f3a0f26b5d
      size: 3934
    - path: sweeps/random/BiasedMF-ALS.json
      hash: md5
      md5: 912861d52f4dd2633ac8542b524b61bc
      size: 310
  export-random-ImplicitMF-ALS:
    cmd: python ../../scripts/sweep.py --export sweeps/random/ImplicitMF-ALS.duckdb
      ndcg
    deps:
    - path: ../../scripts/sweep.py
      hash: md5
      md5: f317b2b216223b72034e4e3b84dfd310
      size: 7543
    - path: sweeps/random/ImplicitMF-ALS.duckdb
      hash: md5
      md5: badd872611dff9b248332935049a7e8e
      size: 281030656
    outs:
    - path: sweeps/random/ImplicitMF-ALS.csv
      hash: md5
      md5: f7b1e7012ff8dd4c9bb513578b241d8c
      size: 2724
    - path: sweeps/random/ImplicitMF-ALS.json
      hash: md5
      md5: 52f4e35d9b6ecac3e34b3031f533b1ff
      size: 250
  export-random-IKNN-Explicit:
    cmd: python ../../scripts/sweep.py --export sweeps/random/IKNN-Explicit.duckdb
      rmse
    deps:
    - path: ../../scripts/sweep.py
      hash: md5
      md5: f317b2b216223b72034e4e3b84dfd310
      size: 7543
    - path: sweeps/random/IKNN-Explicit.duckdb
      hash: md5
      md5: 616f39ffaa5dd90123a2aa94697ee17d
      size: 120598528
    outs:
    - path: sweeps/random/IKNN-Explicit.csv
      hash: md5
      md5: 53a3f3820031e5e90115d476011cab73
      size: 1601
    - path: sweeps/random/IKNN-Explicit.json
      hash: md5
      md5: 3bea74ba6a63e14d648aa5d1de00b080
      size: 312
  export-random-IKNN-Implicit:
    cmd: python ../../scripts/sweep.py --export sweeps/random/IKNN-Implicit.duckdb
      ndcg
    deps:
    - path: ../../scripts/sweep.py
      hash: md5
      md5: f317b2b216223b72034e4e3b84dfd310
      size: 7543
    - path: sweeps/random/IKNN-Implicit.duckdb
      hash: md5
      md5: ccbf0cff15e9b93e5ff088f1b88a6814
      size: 112996352
    outs:
    - path: sweeps/random/IKNN-Implicit.csv
      hash: md5
      md5: 07d8ce67721f839bdcb67b7d864d8a10
      size: 1093
    - path: sweeps/random/IKNN-Implicit.json
      hash: md5
      md5: 463d00b22c8f6d04849c0f1261d50ed2
      size: 253
