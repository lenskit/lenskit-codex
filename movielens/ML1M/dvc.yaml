stages:
  import-ml-1m:
    cmd: python ../import-ml.py ml-1m.zip
    deps:
      - ../import-ml.py
      - ../ml-stats.sql
      - ml-1m.zip
    outs:
      - ratings.duckdb
  split-random:
    cmd: python ../../../scripts/split.py random.toml
    wdir: splits
    params:
      - ../../../config.toml:
          - random.seed
    deps:
      - random.toml
      - ../ratings.duckdb
    outs:
      - random.duckdb
  Bias:
    cmd: >-
      python ../../scripts/sweep.py -p 1 Bias splits/random.duckdb
      ratings.duckdb sweeps/random/Bias.duckdb
    params:
      - ../../config.toml:
          - random.seed
    deps:
      - splits/random.duckdb
      - ratings.duckdb
      - ../../codex/models/Bias.py
    outs:
      - sweeps/random/Bias.duckdb
  BiasedMF-ALS:
    cmd: >-
      python ../../scripts/sweep.py -p 1 BiasedMF-ALS splits/random.duckdb
      ratings.duckdb sweeps/random/BiasedMF-ALS.duckdb
    params:
      - ../../config.toml:
          - random.seed
    deps:
      - splits/random.duckdb
      - ratings.duckdb
      - ../../codex/models/BiasedMF_ALS.py
    outs:
      - sweeps/random/BiasedMF-ALS.duckdb
  ImplicitMF-ALS:
    cmd: >-
      python ../../scripts/sweep.py -p 1 ImplicitMF-ALS splits/random.duckdb
      ratings.duckdb sweeps/random/ImplicitMF-ALS.duckdb
    params:
      - ../../config.toml:
          - random.seed
    deps:
      - splits/random.duckdb
      - ratings.duckdb
      - ../../codex/models/ImplicitMF_ALS.py
    outs:
      - sweeps/random/ImplicitMF-ALS.duckdb
  IKNN_Explicit:
    cmd: >-
      python ../../scripts/sweep.py -p 1 IKNN_Explicit splits/random.duckdb
      ratings.duckdb sweeps/random/IKNN_Explicit.duckdb
    params:
      - ../../config.toml:
          - random.seed
    deps:
      - splits/random.duckdb
      - ratings.duckdb
      - ../../codex/models/IKNN_Explicit.py
    outs:
      - sweeps/random/IKNN_Explicit.duckdb
  IKNN_Implicit:
    cmd: >-
      python ../../scripts/sweep.py -p 1 IKNN_Implicit splits/random.duckdb
      ratings.duckdb sweeps/random/IKNN_Implicit.duckdb
    params:
      - ../../config.toml:
          - random.seed
    deps:
      - splits/random.duckdb
      - ratings.duckdb
      - ../../codex/models/IKNN_Implicit.py
    outs:
      - sweeps/random/IKNN_Implicit.duckdb
