schema: '2.0'
stages:
  import-data:
    cmd: python ../import-ml.py ml-25m.zip
    deps:
    - path: ../import-ml.py
      hash: md5
      md5: 4af94250c13bdd7beff8235e442549c6
      size: 3732
    - path: ml-25m.zip
      hash: md5
      md5: 6b51fb2759a8657d3bfcbfc42b592ada
      size: 261978986
    outs:
    - path: ratings.duckdb
      hash: md5
      md5: 39db36eb36970ddb8a9d3f5c299e7c62
      size: 243019776
  import-ml-25m:
    cmd: python ../import-ml.py ml-25m.zip
    deps:
    - path: ../import-ml.py
      hash: md5
      md5: 30e3b5d3d15e7797637601877711c1ba
      size: 3648
    - path: ../ml-stats.sql
      hash: md5
      md5: b016dc983a2156e0712a846097a968e7
      size: 1307
    - path: ml-25m.zip
      hash: md5
      md5: 6b51fb2759a8657d3bfcbfc42b592ada
      size: 261978986
    outs:
    - path: ratings.duckdb
      hash: md5
      md5: 9463b4c41e34c62316f2518ffa78b1bd
      size: 299642880
  ml-25m-stats:
    cmd: python ../../scripts/duckdb-sql.py -d stats.duckdb ../ml-stats.sql
    deps:
    - path: ../ml-stats.sql
      hash: md5
      md5: bf09f212fabc98275ae949932889654c
      size: 1374
    - path: ratings.parquet
      hash: md5
      md5: 60a83d1b954209733419580cbfb6d27a
      size: 216741269
    outs:
    - path: stats.duckdb
      hash: md5
      md5: 6dcc1794a0e0d90e2cdeb756c84d55b1
      size: 5255168
  split-random:
    cmd: python ../../../action.py split random.toml
    deps:
    - path: ../ratings.duckdb
      hash: md5
      md5: 9463b4c41e34c62316f2518ffa78b1bd
      size: 299642880
    - path: random.toml
      hash: md5
      md5: 276ffa520abcf2243c9ffee115774a98
      size: 137
    params:
      ../../../config.toml:
        random.seed: 20240717
    outs:
    - path: random.duckdb
      hash: md5
      md5: 92e096f49f7567248cc05f3da698da1b
      size: 4730880
  sweep-random-Bias:
    cmd: python ../../scripts/sweep.py -p 1 Bias splits/random.duckdb ratings.duckdb
      sweeps/random/Bias.duckdb
    deps:
    - path: ../../codex/models/Bias.py
      hash: md5
      md5: e35eac761bf892674a6fb8570132e7f1
      size: 375
    - path: ratings.duckdb
      hash: md5
      md5: 9463b4c41e34c62316f2518ffa78b1bd
      size: 299642880
    - path: splits/random.duckdb
      hash: md5
      md5: 92e096f49f7567248cc05f3da698da1b
      size: 4730880
    params:
      ../../config.toml:
        random.seed: 20240717
    outs:
    - path: sweeps/random/Bias.duckdb
      hash: md5
      md5: 59fa7f83f16fde496d8e5f0deaebe18b
      size: 325332992
  sweep-random-BiasedMF-ALS:
    cmd: python ../../scripts/sweep.py -p 1 BiasedMF-ALS splits/random.duckdb ratings.duckdb
      sweeps/random/BiasedMF-ALS.duckdb
    deps:
    - path: ../../codex/models/BiasedMF_ALS.py
      hash: md5
      md5: 70b01ec78dc3f1c3d09190c032bc05a6
      size: 349
    - path: ratings.duckdb
      hash: md5
      md5: 9463b4c41e34c62316f2518ffa78b1bd
      size: 299642880
    - path: splits/random.duckdb
      hash: md5
      md5: 92e096f49f7567248cc05f3da698da1b
      size: 4730880
    params:
      ../../config.toml:
        random.seed: 20240717
    outs:
    - path: sweeps/random/BiasedMF-ALS.duckdb
      hash: md5
      md5: f16fe39296b9ab05ff9b5123239efbe2
      size: 693907456
  sweep-random-ImplicitMF-ALS:
    cmd: python ../../scripts/sweep.py -p 1 ImplicitMF-ALS splits/random.duckdb ratings.duckdb
      sweeps/random/ImplicitMF-ALS.duckdb
    deps:
    - path: ../../codex/models/ImplicitMF_ALS.py
      hash: md5
      md5: f88cb5bd1014e55b8c0d9a1650863c94
      size: 359
    - path: ratings.duckdb
      hash: md5
      md5: 9463b4c41e34c62316f2518ffa78b1bd
      size: 299642880
    - path: splits/random.duckdb
      hash: md5
      md5: 92e096f49f7567248cc05f3da698da1b
      size: 4730880
    params:
      ../../config.toml:
        random.seed: 20240717
    outs:
    - path: sweeps/random/ImplicitMF-ALS.duckdb
      hash: md5
      md5: d706c45a8e0532c3ebc272b08fdbbb21
      size: 644362240
  sweep-random-IKNN-Explicit:
    cmd: python ../../scripts/sweep.py -p 1 IKNN-Explicit splits/random.duckdb ratings.duckdb
      sweeps/random/IKNN-Explicit.duckdb
    deps:
    - path: ../../codex/models/IKNN_Explicit.py
      hash: md5
      md5: d7b6a1734bea39997f94df4fa0c4900e
      size: 378
    - path: ratings.duckdb
      hash: md5
      md5: 9463b4c41e34c62316f2518ffa78b1bd
      size: 299642880
    - path: splits/random.duckdb
      hash: md5
      md5: 92e096f49f7567248cc05f3da698da1b
      size: 4730880
    params:
      ../../config.toml:
        random.seed: 20240717
    outs:
    - path: sweeps/random/IKNN-Explicit.duckdb
      hash: md5
      md5: 5a1ac51bdc4997cb1f497d7019365b7c
      size: 278409216
  sweep-random-IKNN-Implicit:
    cmd: python ../../scripts/sweep.py -p 1 IKNN-Implicit splits/random.duckdb ratings.duckdb
      sweeps/random/IKNN-Implicit.duckdb
    deps:
    - path: ../../codex/models/IKNN_Implicit.py
      hash: md5
      md5: 3ca2f37d6c1983760fcd2ff03a0a57cb
      size: 363
    - path: ratings.duckdb
      hash: md5
      md5: 9463b4c41e34c62316f2518ffa78b1bd
      size: 299642880
    - path: splits/random.duckdb
      hash: md5
      md5: 92e096f49f7567248cc05f3da698da1b
      size: 4730880
    params:
      ../../config.toml:
        random.seed: 20240717
    outs:
    - path: sweeps/random/IKNN-Implicit.duckdb
      hash: md5
      md5: 955a00017d5762b62637235b20ec7949
      size: 259534848
  import:
    cmd: python ../import-ml.py ml-25m.zip
    deps:
    - path: ../import-ml.py
      hash: md5
      md5: af82da24d16bfef7681fe0b7910d5069
      size: 3678
    - path: ../ml-stats.sql
      hash: md5
      md5: b016dc983a2156e0712a846097a968e7
      size: 1307
    - path: ml-25m.zip
      hash: md5
      md5: 6b51fb2759a8657d3bfcbfc42b592ada
      size: 261978986
    outs:
    - path: ratings.duckdb
      hash: md5
      md5: 9463b4c41e34c62316f2518ffa78b1bd
      size: 299642880
  export-random-Bias:
    cmd: python ../../scripts/sweep.py --export sweeps/random/Bias.duckdb rmse
    deps:
    - path: ../../scripts/sweep.py
      hash: md5
      md5: f317b2b216223b72034e4e3b84dfd310
      size: 7543
    - path: sweeps/random/Bias.duckdb
      hash: md5
      md5: 59fa7f83f16fde496d8e5f0deaebe18b
      size: 325332992
    outs:
    - path: sweeps/random/Bias.csv
      hash: md5
      md5: 7cffa48415a320856572517808c01197
      size: 1960
    - path: sweeps/random/Bias.json
      hash: md5
      md5: de5261d41666224378a4d860db15e9dc
      size: 323
  export-random-BiasedMF-ALS:
    cmd: python ../../scripts/sweep.py --export sweeps/random/BiasedMF-ALS.duckdb
      rmse
    deps:
    - path: ../../scripts/sweep.py
      hash: md5
      md5: f317b2b216223b72034e4e3b84dfd310
      size: 7543
    - path: sweeps/random/BiasedMF-ALS.duckdb
      hash: md5
      md5: f16fe39296b9ab05ff9b5123239efbe2
      size: 693907456
    outs:
    - path: sweeps/random/BiasedMF-ALS.csv
      hash: md5
      md5: 705c8da85ebee6ea2bfcdd4474fac9db
      size: 3973
    - path: sweeps/random/BiasedMF-ALS.json
      hash: md5
      md5: 369970a9dc364c92617e7360448eccc1
      size: 310
  export-random-ImplicitMF-ALS:
    cmd: python ../../scripts/sweep.py --export sweeps/random/ImplicitMF-ALS.duckdb
      ndcg
    deps:
    - path: ../../scripts/sweep.py
      hash: md5
      md5: f317b2b216223b72034e4e3b84dfd310
      size: 7543
    - path: sweeps/random/ImplicitMF-ALS.duckdb
      hash: md5
      md5: d706c45a8e0532c3ebc272b08fdbbb21
      size: 644362240
    outs:
    - path: sweeps/random/ImplicitMF-ALS.csv
      hash: md5
      md5: 2000e39673c444bda200cd942878c987
      size: 2724
    - path: sweeps/random/ImplicitMF-ALS.json
      hash: md5
      md5: 794b4fd49c21c734269719b9583c88bd
      size: 252
  export-random-IKNN-Explicit:
    cmd: python ../../scripts/sweep.py --export sweeps/random/IKNN-Explicit.duckdb
      rmse
    deps:
    - path: ../../scripts/sweep.py
      hash: md5
      md5: f317b2b216223b72034e4e3b84dfd310
      size: 7543
    - path: sweeps/random/IKNN-Explicit.duckdb
      hash: md5
      md5: 5a1ac51bdc4997cb1f497d7019365b7c
      size: 278409216
    outs:
    - path: sweeps/random/IKNN-Explicit.csv
      hash: md5
      md5: 69a317925f0e1fded300520b2de6394f
      size: 1623
    - path: sweeps/random/IKNN-Explicit.json
      hash: md5
      md5: 7f6ae96446bb437d05ca0aecef287fba
      size: 311
  export-random-IKNN-Implicit:
    cmd: python ../../scripts/sweep.py --export sweeps/random/IKNN-Implicit.duckdb
      ndcg
    deps:
    - path: ../../scripts/sweep.py
      hash: md5
      md5: f317b2b216223b72034e4e3b84dfd310
      size: 7543
    - path: sweeps/random/IKNN-Implicit.duckdb
      hash: md5
      md5: 955a00017d5762b62637235b20ec7949
      size: 259534848
    outs:
    - path: sweeps/random/IKNN-Implicit.csv
      hash: md5
      md5: d5ed7ede11d023ed9341b8c5a4173387
      size: 1091
    - path: sweeps/random/IKNN-Implicit.json
      hash: md5
      md5: 84af41a852d9de5384eee345ee735c67
      size: 250
