schema: '2.0'
stages:
  import-ml-32m:
    cmd: python ../import-ml.py ml-32m.zip
    deps:
    - path: ../import-ml.py
      hash: md5
      md5: 30e3b5d3d15e7797637601877711c1ba
      size: 3648
    - path: ../ml-stats.sql
      hash: md5
      md5: b016dc983a2156e0712a846097a968e7
      size: 1307
    - path: ml-32m.zip
      hash: md5
      md5: d472be332d4daa821edc399621853b57
      size: 238950008
    outs:
    - path: ratings.duckdb
      hash: md5
      md5: bb6c15fab0f9f49d334babc97b3b3ef6
      size: 381693952
  import:
    cmd: lenskit-codex movielens import --stat-sql=../ml-stats.sql ml-32m.zip
    deps:
    - path: ../ml-stats.sql
      hash: md5
      md5: b016dc983a2156e0712a846097a968e7
      size: 1307
    - path: ml-32m.zip
      hash: md5
      md5: d472be332d4daa821edc399621853b57
      size: 238950008
    outs:
    - path: ratings.duckdb
      hash: md5
      md5: a81c61d4b9ee0568294bdec12ad5a7de
      size: 383004672
  split-random:
    cmd: lenskit-codex split random.toml
    deps:
    - path: ../ratings.duckdb
      hash: md5
      md5: a81c61d4b9ee0568294bdec12ad5a7de
      size: 383004672
    - path: random.toml
      hash: md5
      md5: 276ffa520abcf2243c9ffee115774a98
      size: 137
    params:
      ../../../config.toml:
        random.seed: 20240717
    outs:
    - path: random.duckdb
      hash: md5
      md5: 28811d3c9cca0f3d1606042b4b5321e9
      size: 5517312
  run-random-default-Popular:
    cmd: lenskit-codex generate --default --test-part=-0 --assignments=splits/random.duckdb
      --ratings=ratings.duckdb -o runs/random-default/Popular Popular
    deps:
    - path: ../../models/Popular.toml
      hash: md5
      md5: c25817c7ea3901786434261d27af0aad
      size: 35
    - path: ratings.duckdb
      hash: md5
      md5: a81c61d4b9ee0568294bdec12ad5a7de
      size: 383004672
    - path: splits/random.duckdb
      hash: md5
      md5: 28811d3c9cca0f3d1606042b4b5321e9
      size: 5517312
    outs:
    - path: runs/random-default/Popular
      hash: md5
      md5: 6f8af1a042f598fa9a195af1b6bdea5a.dir
      size: 12874047
      nfiles: 35
  collect-metrics:
    cmd: lenskit-codex collect metrics run-metrics.duckdb --view-script=../ml-run-metrics.sql
      runs
    outs:
    - path: run-metrics.duckdb
      hash: md5
      md5: c2a8970f70fa35e84daa208593b39b5a
      size: 274432
  run-temporal-valid-default-ImplicitMF-ALS:
    cmd: lenskit-codex generate --default --split=splits/temporal.toml --test-part=valid
      -o runs/temporal-valid-default/ImplicitMF-ALS ImplicitMF-ALS
    deps:
    - path: ../../models/ImplicitMF-ALS.toml
      hash: md5
      md5: e3b0120ab5820325128a9eb87d851e7f
      size: 151
    - path: ratings.duckdb
      hash: md5
      md5: a81c61d4b9ee0568294bdec12ad5a7de
      size: 383004672
    - path: splits/temporal.toml
      hash: md5
      md5: fb7e01165c4c72af87a6a499697e4d33
      size: 116
    outs:
    - path: runs/temporal-valid-default/ImplicitMF-ALS
      hash: md5
      md5: 570f24cea40a1c1a157aa1dfd54e0a0a.dir
      size: 5223357
      nfiles: 11
  run-temporal-valid-default-UKNN-Implicit:
    cmd: lenskit-codex generate --default --split=splits/temporal.toml --test-part=valid
      -o runs/temporal-valid-default/UKNN-Implicit UKNN-Implicit
    deps:
    - path: ../../models/UKNN-Implicit.toml
      hash: md5
      md5: a58a3e7ad35116cb737f895bab17c799
      size: 152
    - path: ratings.duckdb
      hash: md5
      md5: a81c61d4b9ee0568294bdec12ad5a7de
      size: 383004672
    - path: splits/temporal.toml
      hash: md5
      md5: fb7e01165c4c72af87a6a499697e4d33
      size: 116
    outs:
    - path: runs/temporal-valid-default/UKNN-Implicit
      hash: md5
      md5: 12cbe30aef1485aa66823cf28e793906.dir
      size: 5054679
      nfiles: 11
