schema: '2.0'
stages:
  import-data:
    cmd: python ../import-ml.py ml-20m.zip
    deps:
    - path: ../import-ml.py
      hash: md5
      md5: 4af94250c13bdd7beff8235e442549c6
      size: 3732
    - path: ml-20m.zip
      hash: md5
      md5: cd245b17a1ae2cc31bb14903e1204af3
      size: 198702078
    outs:
    - path: ratings.duckdb
      hash: md5
      md5: f056b72df139341f2d451e69f4624ea9
      size: 190328832
  import-ml-20m:
    cmd: python ../import-ml.py ml-20m.zip
    deps:
    - path: ../import-ml.py
      hash: md5
      md5: 30e3b5d3d15e7797637601877711c1ba
      size: 3648
    - path: ../ml-stats.sql
      hash: md5
      md5: b016dc983a2156e0712a846097a968e7
      size: 1307
    - path: ml-20m.zip
      hash: md5
      md5: cd245b17a1ae2cc31bb14903e1204af3
      size: 198702078
    outs:
    - path: ratings.duckdb
      hash: md5
      md5: cccd30242af2c39130c7e15a6e20a523
      size: 239874048
  ml-20m-stats:
    cmd: python ../../scripts/duckdb-sql.py -d stats.duckdb ../ml-stats.sql
    deps:
    - path: ../ml-stats.sql
      hash: md5
      md5: bf09f212fabc98275ae949932889654c
      size: 1374
    - path: ratings.parquet
      hash: md5
      md5: 0dc579f176e5f798b67fda4ee0873b27
      size: 165821204
    outs:
    - path: stats.duckdb
      hash: md5
      md5: cc596bebeb0b9d8738a06ad937166ce6
      size: 4468736
  split-random:
    cmd: python ../../../action.py split random.toml
    deps:
    - path: ../ratings.duckdb
      hash: md5
      md5: cccd30242af2c39130c7e15a6e20a523
      size: 239874048
    - path: random.toml
      hash: md5
      md5: 276ffa520abcf2243c9ffee115774a98
      size: 137
    params:
      ../../../config.toml:
        random.seed: 20240717
    outs:
    - path: random.duckdb
      hash: md5
      md5: a82c2ba5fa6de4e71538a26dca72079d
      size: 3944448
  sweep-random-Bias:
    cmd: python ../../action.py sweep run -p 0 --ratings=ratings.duckdb --assignments=splits/random.duckdb
      Bias sweeps/random/Bias.duckdb
    deps:
    - path: ../../codex/models/Bias.py
      hash: md5
      md5: e35eac761bf892674a6fb8570132e7f1
      size: 375
    - path: ratings.duckdb
      hash: md5
      md5: cccd30242af2c39130c7e15a6e20a523
      size: 239874048
    - path: splits/random.duckdb
      hash: md5
      md5: a82c2ba5fa6de4e71538a26dca72079d
      size: 3944448
    params:
      ../../config.toml:
        random.seed: 20240717
    outs:
    - path: sweeps/random/Bias.duckdb
      hash: md5
      md5: c9c650c2aa9527fb7ac1118d6e3c0372
      size: 281554944
  sweep-random-BiasedMF-ALS:
    cmd: python ../../action.py sweep run -p 0 --ratings=ratings.duckdb --assignments=splits/random.duckdb
      BiasedMF-ALS sweeps/random/BiasedMF-ALS.duckdb
    deps:
    - path: ../../codex/models/BiasedMF_ALS.py
      hash: md5
      md5: 70b01ec78dc3f1c3d09190c032bc05a6
      size: 349
    - path: ratings.duckdb
      hash: md5
      md5: cccd30242af2c39130c7e15a6e20a523
      size: 239874048
    - path: splits/random.duckdb
      hash: md5
      md5: a82c2ba5fa6de4e71538a26dca72079d
      size: 3944448
    params:
      ../../config.toml:
        random.seed: 20240717
    outs:
    - path: sweeps/random/BiasedMF-ALS.duckdb
      hash: md5
      md5: f667d9e1df5677a4d3656cdcaa83b0bc
      size: 591409152
  sweep-random-ImplicitMF-ALS:
    cmd: python ../../action.py sweep run -p 0 --ratings=ratings.duckdb --assignments=splits/random.duckdb
      ImplicitMF-ALS sweeps/random/ImplicitMF-ALS.duckdb
    deps:
    - path: ../../codex/models/ImplicitMF_ALS.py
      hash: md5
      md5: f88cb5bd1014e55b8c0d9a1650863c94
      size: 359
    - path: ratings.duckdb
      hash: md5
      md5: cccd30242af2c39130c7e15a6e20a523
      size: 239874048
    - path: splits/random.duckdb
      hash: md5
      md5: a82c2ba5fa6de4e71538a26dca72079d
      size: 3944448
    params:
      ../../config.toml:
        random.seed: 20240717
    outs:
    - path: sweeps/random/ImplicitMF-ALS.duckdb
      hash: md5
      md5: d5745ada950a74f65a4680235ee152cc
      size: 545271808
  sweep-random-IKNN-Explicit:
    cmd: python ../../action.py sweep run -p 0 --ratings=ratings.duckdb --assignments=splits/random.duckdb
      IKNN-Explicit sweeps/random/IKNN-Explicit.duckdb
    deps:
    - path: ../../codex/models/IKNN_Explicit.py
      hash: md5
      md5: d7b6a1734bea39997f94df4fa0c4900e
      size: 378
    - path: ratings.duckdb
      hash: md5
      md5: cccd30242af2c39130c7e15a6e20a523
      size: 239874048
    - path: splits/random.duckdb
      hash: md5
      md5: a82c2ba5fa6de4e71538a26dca72079d
      size: 3944448
    params:
      ../../config.toml:
        random.seed: 20240717
    outs:
    - path: sweeps/random/IKNN-Explicit.duckdb
      hash: md5
      md5: 1457d8a5d0b3acda4fbb58491f41d8ff
      size: 237776896
  sweep-random-IKNN-Implicit:
    cmd: python ../../action.py sweep run -p 0 --ratings=ratings.duckdb --assignments=splits/random.duckdb
      IKNN-Implicit sweeps/random/IKNN-Implicit.duckdb
    deps:
    - path: ../../codex/models/IKNN_Implicit.py
      hash: md5
      md5: 3ca2f37d6c1983760fcd2ff03a0a57cb
      size: 363
    - path: ratings.duckdb
      hash: md5
      md5: cccd30242af2c39130c7e15a6e20a523
      size: 239874048
    - path: splits/random.duckdb
      hash: md5
      md5: a82c2ba5fa6de4e71538a26dca72079d
      size: 3944448
    params:
      ../../config.toml:
        random.seed: 20240717
    outs:
    - path: sweeps/random/IKNN-Implicit.duckdb
      hash: md5
      md5: b1840d89dc964f2f5d4e7101d57076cc
      size: 219164672
  import:
    cmd: python ../../action.py movielens import --stat-sql=../ml-stats.sql ml-20m.zip
    deps:
    - path: ../ml-stats.sql
      hash: md5
      md5: b016dc983a2156e0712a846097a968e7
      size: 1307
    - path: ml-20m.zip
      hash: md5
      md5: cd245b17a1ae2cc31bb14903e1204af3
      size: 198702078
    outs:
    - path: ratings.duckdb
      hash: md5
      md5: cccd30242af2c39130c7e15a6e20a523
      size: 239874048
  export-random-Bias:
    cmd: python ../../action.py sweep export sweeps/random/Bias.duckdb rmse
    deps:
    - path: sweeps/random/Bias.duckdb
      hash: md5
      md5: d4d43752ed9ea20fd6b91dd759d2351e
      size: 281554944
    outs:
    - path: sweeps/random/Bias.csv
      hash: md5
      md5: 4b521beba30c948b01da0f68f9916004
      size: 2097
    - path: sweeps/random/Bias.json
      hash: md5
      md5: ca429d7bc0a9ee4b5f621c7e18a636ed
      size: 321
  export-random-BiasedMF-ALS:
    cmd: python ../../action.py sweep export sweeps/random/BiasedMF-ALS.duckdb rmse
    deps:
    - path: sweeps/random/BiasedMF-ALS.duckdb
      hash: md5
      md5: 47d1465d4d6dab1c5a4b8c533fa1511f
      size: 591409152
    outs:
    - path: sweeps/random/BiasedMF-ALS.csv
      hash: md5
      md5: 9df3bbf82007c590e854e5dfdc28a4fe
      size: 3942
    - path: sweeps/random/BiasedMF-ALS.json
      hash: md5
      md5: 5e15ca080d7807e775ff2d5588735ac8
      size: 313
  export-random-ImplicitMF-ALS:
    cmd: python ../../action.py sweep export sweeps/random/ImplicitMF-ALS.duckdb ndcg
    deps:
    - path: sweeps/random/ImplicitMF-ALS.duckdb
      hash: md5
      md5: 84526d1e1da9b1a36346286b10a81596
      size: 545271808
    outs:
    - path: sweeps/random/ImplicitMF-ALS.csv
      hash: md5
      md5: 3f0b3f3ff447ca5c4bb1dca8413f028f
      size: 2724
    - path: sweeps/random/ImplicitMF-ALS.json
      hash: md5
      md5: 25a670a3fa74d8cd013fdd4558d6e912
      size: 248
  export-random-IKNN-Explicit:
    cmd: python ../../action.py sweep export sweeps/random/IKNN-Explicit.duckdb rmse
    deps:
    - path: sweeps/random/IKNN-Explicit.duckdb
      hash: md5
      md5: 2f5edd066a321e95bb300f2bbd347cba
      size: 237776896
    outs:
    - path: sweeps/random/IKNN-Explicit.csv
      hash: md5
      md5: 940fd06f540c672a9f1b1b64db48aa01
      size: 1604
    - path: sweeps/random/IKNN-Explicit.json
      hash: md5
      md5: 8a00b47e1b08a04dfc2db8e5ab8e4685
      size: 314
  export-random-IKNN-Implicit:
    cmd: python ../../action.py sweep export sweeps/random/IKNN-Implicit.duckdb ndcg
    deps:
    - path: sweeps/random/IKNN-Implicit.duckdb
      hash: md5
      md5: 222435bc78c0caf94d304a0b1fc7d39a
      size: 219164672
    outs:
    - path: sweeps/random/IKNN-Implicit.csv
      hash: md5
      md5: de98b257340f942537d082867198e73f
      size: 1111
    - path: sweeps/random/IKNN-Implicit.json
      hash: md5
      md5: 20361c8f84eeb4afd908d2cd9b66e5e6
      size: 250
  run-random-default-Bias:
    cmd: python ../../action.py generate --default --test-part=-0 --assignments=splits/random.duckdb
      --ratings=ratings.duckdb --stats=runs/random-default/Bias.json --recommendations=runs/random-default/Bias-recs.parquet
      --predictions=runs/random-default/Bias-preds.parquet Bias
    deps:
    - path: ../../codex/models/Bias.py
      hash: md5
      md5: e35eac761bf892674a6fb8570132e7f1
      size: 375
    - path: ratings.duckdb
      hash: md5
      md5: cccd30242af2c39130c7e15a6e20a523
      size: 239874048
    - path: splits/random.duckdb
      hash: md5
      md5: a82c2ba5fa6de4e71538a26dca72079d
      size: 3944448
    outs:
    - path: runs/random-default/Bias-preds.parquet
      hash: md5
      md5: 928b6d9236d01ee4b3222d06a075972c
      size: 6883153
    - path: runs/random-default/Bias-recs.parquet
      hash: md5
      md5: 3aabfea9b77c78b033093ac8c61c06f7
      size: 19980548048
    - path: runs/random-default/Bias.json
      hash: md5
      md5: 0f7ca4add41ab4db8073abfddc3b620e
      size: 633
  run-random-sweep-best-Bias:
    cmd: python ../../action.py generate --param-file=sweeps/random/Bias.json --test-part=-0
      --assignments=splits/random.duckdb --ratings=ratings.duckdb -o runs/random-sweep-best/Bias.duckdb
      Bias
    deps:
    - path: ../../codex/models/Bias.py
      hash: md5
      md5: e35eac761bf892674a6fb8570132e7f1
      size: 375
    - path: ratings.duckdb
      hash: md5
      md5: cccd30242af2c39130c7e15a6e20a523
      size: 239874048
    - path: splits/random.duckdb
      hash: md5
      md5: a82c2ba5fa6de4e71538a26dca72079d
      size: 3944448
    - path: sweeps/random/Bias.json
      hash: md5
      md5: ca429d7bc0a9ee4b5f621c7e18a636ed
      size: 321
    outs:
    - path: runs/random-sweep-best/Bias.duckdb
      hash: md5
      md5: 535516ab3d051fb0efb7a2eb2d3f01c1
      size: 87044096
  run-random-default-Popular:
    cmd: python ../../action.py generate --default --test-part=-0 --assignments=splits/random.duckdb
      --ratings=ratings.duckdb --stats=runs/random-default/Popular.json --recommendations=runs/random-default/Popular-recs.parquet
      Popular
    deps:
    - path: ../../codex/models/Popular.py
      hash: md5
      md5: 6e8ad3acdea3e26808c9796209279f35
      size: 224
    - path: ratings.duckdb
      hash: md5
      md5: cccd30242af2c39130c7e15a6e20a523
      size: 239874048
    - path: splits/random.duckdb
      hash: md5
      md5: a82c2ba5fa6de4e71538a26dca72079d
      size: 3944448
    outs:
    - path: runs/random-default/Popular-recs.parquet
      hash: md5
      md5: d78b0effbe6c6ed5f316c7b8749c191d
      size: 10720583779
    - path: runs/random-default/Popular.json
      hash: md5
      md5: 3111b3e108d47625b8463b7554a04d1c
      size: 650
  run-random-default-BiasedMF-ALS:
    cmd: python ../../action.py generate --default --test-part=-0 --assignments=splits/random.duckdb
      --ratings=ratings.duckdb --stats=runs/random-default/BiasedMF-ALS.json --recommendations=runs/random-default/BiasedMF-ALS-recs.parquet
      --predictions=runs/random-default/BiasedMF-ALS-preds.parquet BiasedMF-ALS
    deps:
    - path: ../../codex/models/BiasedMF_ALS.py
      hash: md5
      md5: 70b01ec78dc3f1c3d09190c032bc05a6
      size: 349
    - path: ratings.duckdb
      hash: md5
      md5: cccd30242af2c39130c7e15a6e20a523
      size: 239874048
    - path: splits/random.duckdb
      hash: md5
      md5: a82c2ba5fa6de4e71538a26dca72079d
      size: 3944448
    outs:
    - path: runs/random-default/BiasedMF-ALS-preds.parquet
      hash: md5
      md5: 1db58390fd6b29ad7175b8ab3b1a21e2
      size: 6896437
    - path: runs/random-default/BiasedMF-ALS-recs.parquet
      hash: md5
      md5: 03e7dcc154250a6b60f53ed9ce064d09
      size: 30018493327
    - path: runs/random-default/BiasedMF-ALS.json
      hash: md5
      md5: 2c65ee7fa5003772b70b2428e5ad7677
      size: 626
  run-random-sweep-best-BiasedMF-ALS:
    cmd: python ../../action.py generate --param-file=sweeps/random/BiasedMF-ALS.json
      --test-part=-0 --assignments=splits/random.duckdb --ratings=ratings.duckdb --stats=runs/random-sweep-best/BiasedMF-ALS.json
      --recommendations=runs/random-sweep-best/BiasedMF-ALS-recs.parquet --predictions=runs/random-sweep-best/BiasedMF-ALS-preds.parquet
      BiasedMF-ALS
    deps:
    - path: ../../codex/models/BiasedMF_ALS.py
      hash: md5
      md5: 70b01ec78dc3f1c3d09190c032bc05a6
      size: 349
    - path: ratings.duckdb
      hash: md5
      md5: cccd30242af2c39130c7e15a6e20a523
      size: 239874048
    - path: splits/random.duckdb
      hash: md5
      md5: a82c2ba5fa6de4e71538a26dca72079d
      size: 3944448
    - path: sweeps/random/BiasedMF-ALS.json
      hash: md5
      md5: 5e15ca080d7807e775ff2d5588735ac8
      size: 313
    outs:
    - path: runs/random-sweep-best/BiasedMF-ALS-preds.parquet
      hash: md5
      md5: 35815edace16f342b6f8fe9d72b86620
      size: 6896342
    - path: runs/random-sweep-best/BiasedMF-ALS-recs.parquet
      hash: md5
      md5: 4598769abaa557fe75c56f2f352fb9a1
      size: 30092586329
    - path: runs/random-sweep-best/BiasedMF-ALS.json
      hash: md5
      md5: 8237b907875c3b27fbaf2c4ba8adf5f1
      size: 637
  run-random-default-ImplicitMF-ALS:
    cmd: python ../../action.py generate --default --test-part=-0 --assignments=splits/random.duckdb
      --ratings=ratings.duckdb --stats=runs/random-default/ImplicitMF-ALS.json --recommendations=runs/random-default/ImplicitMF-ALS-recs.parquet
      ImplicitMF-ALS
    deps:
    - path: ../../codex/models/ImplicitMF_ALS.py
      hash: md5
      md5: f88cb5bd1014e55b8c0d9a1650863c94
      size: 359
    - path: ratings.duckdb
      hash: md5
      md5: cccd30242af2c39130c7e15a6e20a523
      size: 239874048
    - path: splits/random.duckdb
      hash: md5
      md5: a82c2ba5fa6de4e71538a26dca72079d
      size: 3944448
    outs:
    - path: runs/random-default/ImplicitMF-ALS-recs.parquet
      hash: md5
      md5: fc73064f6b7f5dab2f0f05709f5fbbbb
      size: 32100985635
    - path: runs/random-default/ImplicitMF-ALS.json
      hash: md5
      md5: c5d66beae130a4525228742bbf261509
      size: 617
  run-random-sweep-best-ImplicitMF-ALS:
    cmd: python ../../action.py generate --param-file=sweeps/random/ImplicitMF-ALS.json
      --test-part=-0 --assignments=splits/random.duckdb --ratings=ratings.duckdb --stats=runs/random-sweep-best/ImplicitMF-ALS.json
      --recommendations=runs/random-sweep-best/ImplicitMF-ALS-recs.parquet ImplicitMF-ALS
    deps:
    - path: ../../codex/models/ImplicitMF_ALS.py
      hash: md5
      md5: f88cb5bd1014e55b8c0d9a1650863c94
      size: 359
    - path: ratings.duckdb
      hash: md5
      md5: cccd30242af2c39130c7e15a6e20a523
      size: 239874048
    - path: splits/random.duckdb
      hash: md5
      md5: a82c2ba5fa6de4e71538a26dca72079d
      size: 3944448
    - path: sweeps/random/ImplicitMF-ALS.json
      hash: md5
      md5: 25a670a3fa74d8cd013fdd4558d6e912
      size: 248
    outs:
    - path: runs/random-sweep-best/ImplicitMF-ALS-recs.parquet
      hash: md5
      md5: 483dda8cc8de8a23b2adf1afcce3947c
      size: 32200608079
    - path: runs/random-sweep-best/ImplicitMF-ALS.json
      hash: md5
      md5: b9201c644ba8ec057cdf3e34df52aeba
      size: 612
  run-random-default-IKNN-Explicit:
    cmd: python ../../action.py generate --default --test-part=-0 --assignments=splits/random.duckdb
      --ratings=ratings.duckdb --stats=runs/random-default/IKNN-Explicit.json --recommendations=runs/random-default/IKNN-Explicit-recs.parquet
      --predictions=runs/random-default/IKNN-Explicit-preds.parquet IKNN-Explicit
    deps:
    - path: ../../codex/models/IKNN_Explicit.py
      hash: md5
      md5: d7b6a1734bea39997f94df4fa0c4900e
      size: 378
    - path: ratings.duckdb
      hash: md5
      md5: cccd30242af2c39130c7e15a6e20a523
      size: 239874048
    - path: splits/random.duckdb
      hash: md5
      md5: a82c2ba5fa6de4e71538a26dca72079d
      size: 3944448
    outs:
    - path: runs/random-default/IKNN-Explicit-preds.parquet
      hash: md5
      md5: 39d04ef5ee8ad2c0ae4ba5a20783cf32
      size: 6902462
    - path: runs/random-default/IKNN-Explicit-recs.parquet
      hash: md5
      md5: e783a3ce67d3681a87278ac493002b12
      size: 26024149838
    - path: runs/random-default/IKNN-Explicit.json
      hash: md5
      md5: a71c8fe250fe0c4d29b43383757198c3
      size: 595
  run-random-sweep-best-IKNN-Explicit:
    cmd: python ../../action.py generate --param-file=sweeps/random/IKNN-Explicit.json
      --test-part=-0 --assignments=splits/random.duckdb --ratings=ratings.duckdb --stats=runs/random-sweep-best/IKNN-Explicit.json
      --recommendations=runs/random-sweep-best/IKNN-Explicit-recs.parquet --predictions=runs/random-sweep-best/IKNN-Explicit-preds.parquet
      IKNN-Explicit
    deps:
    - path: ../../codex/models/IKNN_Explicit.py
      hash: md5
      md5: d7b6a1734bea39997f94df4fa0c4900e
      size: 378
    - path: ratings.duckdb
      hash: md5
      md5: cccd30242af2c39130c7e15a6e20a523
      size: 239874048
    - path: splits/random.duckdb
      hash: md5
      md5: a82c2ba5fa6de4e71538a26dca72079d
      size: 3944448
    - path: sweeps/random/IKNN-Explicit.json
      hash: md5
      md5: 8a00b47e1b08a04dfc2db8e5ab8e4685
      size: 314
    outs:
    - path: runs/random-sweep-best/IKNN-Explicit-preds.parquet
      hash: md5
      md5: 1dd96540a1b3497f98352f8f10e1c54a
      size: 6909502
    - path: runs/random-sweep-best/IKNN-Explicit-recs.parquet
      hash: md5
      md5: 59b1ec185a750894cc72ab177e309c19
      size: 26030418166
    - path: runs/random-sweep-best/IKNN-Explicit.json
      hash: md5
      md5: 5ee6a27eab55379171c3e9f8d12ff0bd
      size: 610
  run-random-default-IKNN-Implicit:
    cmd: python ../../action.py generate --default --test-part=-0 --assignments=splits/random.duckdb
      --ratings=ratings.duckdb --stats=runs/random-default/IKNN-Implicit.json --recommendations=runs/random-default/IKNN-Implicit-recs.parquet
      IKNN-Implicit
    deps:
    - path: ../../codex/models/IKNN_Implicit.py
      hash: md5
      md5: 3ca2f37d6c1983760fcd2ff03a0a57cb
      size: 363
    - path: ratings.duckdb
      hash: md5
      md5: cccd30242af2c39130c7e15a6e20a523
      size: 239874048
    - path: splits/random.duckdb
      hash: md5
      md5: a82c2ba5fa6de4e71538a26dca72079d
      size: 3944448
    outs:
    - path: runs/random-default/IKNN-Implicit-recs.parquet
      hash: md5
      md5: 2a25e8e5cb2ca443d75a88103eeec7b7
      size: 29358065706
    - path: runs/random-default/IKNN-Implicit.json
      hash: md5
      md5: 478a87bf6ae05ce1f564c237fbe863ff
      size: 619
  run-random-sweep-best-IKNN-Implicit:
    cmd: python ../../action.py generate --param-file=sweeps/random/IKNN-Implicit.json
      --test-part=-0 --assignments=splits/random.duckdb --ratings=ratings.duckdb --stats=runs/random-sweep-best/IKNN-Implicit.json
      --recommendations=runs/random-sweep-best/IKNN-Implicit-recs.parquet IKNN-Implicit
    deps:
    - path: ../../codex/models/IKNN_Implicit.py
      hash: md5
      md5: 3ca2f37d6c1983760fcd2ff03a0a57cb
      size: 363
    - path: ratings.duckdb
      hash: md5
      md5: cccd30242af2c39130c7e15a6e20a523
      size: 239874048
    - path: splits/random.duckdb
      hash: md5
      md5: a82c2ba5fa6de4e71538a26dca72079d
      size: 3944448
    - path: sweeps/random/IKNN-Implicit.json
      hash: md5
      md5: 20361c8f84eeb4afd908d2cd9b66e5e6
      size: 250
    outs:
    - path: runs/random-sweep-best/IKNN-Implicit-recs.parquet
      hash: md5
      md5: 0cd17152551662504293c2beffc140bc
      size: 29401146172
    - path: runs/random-sweep-best/IKNN-Implicit.json
      hash: md5
      md5: 850eb2cf564d9ac9d1232cd0016dcf8c
      size: 620
